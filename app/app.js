'use strict';

// Declare app level module which depends on views, and components
angular.module('myApp', [
  'ngRoute',
  'myApp.view1',
  'myApp.view2',
  'myApp.createTile',
  'myApp.version',
  'ngAnimate'
]).
config(['$routeProvider', function($routeProvider) {
  $routeProvider.otherwise({redirectTo: '/createTile'});
}]).
factory('PageService', function() {
	var numberOfCategoryTiles = 0;
	return {
		pageTitle: "Page Title",
		categoryTiles: [],
		reservedClasses: {
			expandTile : ' expandTile'
		}
	};
})
.controller('GenerateHtmlCtrl', ['$scope', 'PageService', '$rootScope', '$sce', function($scope, PageService, $rootScope, $sce) {
	$rootScope.$on("updateHtml", function(event, args) {
		var templateString = '<h3>{{=it.pageTitle}}</h3><div class="catPageTiles">{{~it.categoryTiles : categoryTile : index}}<div class="catTile subcategory-tile-menu{{? categoryTile.hasSubtile}}{{=it.reservedClasses.expandTile}}{{?}}" id="{{=categoryTile.btnId}}"{{? categoryTile.hasSubtile}}selenium="expandTile"{{?}}>{{? !categoryTile.hasSubtile}}<a href="{{=categoryTile.url}}" selenium="checkLink" title="{{=categoryTile.title}}">{{?}}<img src="{{=categoryTile.imageUrl}}" alt="{{=categoryTile.title}}"><p class="txtLink">{{=categoryTile.title}}</p><div class="btnLinkWrapper"><p class="btnLink">SHOP NOW{{? categoryTile.hasSubtile}}<span class="btnLinkIndicator" style="background: url(http://www.appliancesonline.com.au/images/opt/washing-v2/images/up.png) 0px 11px no-repeat;"></span>{{?}}</p></div>{{? !categoryTile.hasSubtile}}</a>{{?}}</div>{{? (index+1) % 3==0}}{{~[1,2,3] : c}}{{? it.categoryTiles[(index+1)-c].hasSubtile}}<div class="submenu-expand" id="{{=it.categoryTiles[(index+1)-c].subTile.id}}" style="display:none;width: 100%;"><span class="indicator"></span><div class="catTile subTile shopAllTile"><a selenium="checkLink" href="{{=it.categoryTiles[(index+1)-c].subTile.shopAllUrl}}" title="Shop All{{=it.categoryTiles[(index+1)-c].title}}"><img src="{{=it.categoryTiles[(index+1)-c].subTile.shopAllImageUrl}}"><p class="txtLink">All&nbsp;{{=it.categoryTiles[(index+1)-c].title}}</p><div class="btnLinkWrapper"><p class="btnLink">SHOP ALL</p></div></a></div><div class="catTile subTile popularFilterTile"><p class="txtLink">{{=it.categoryTiles[(index+1)-c].subTile.popularFilterTitle}}</p><img src="{{=it.categoryTiles[(index+1)-c].subTile.popularFilterImageUrl}}" class="subImg" alt="{{=it.categoryTiles[(index+1)-c].subTile.popularFilterTitle}}"><div class="btnLinkWrapper desktopLinks">{{~it.categoryTiles[(index+1)-c].subTile.popularFilterOptions : popularFilterOption}}<a selenium="checkLink" class="btnLink" href="{{=popularFilterOption[1]}}" title="{{=it.categoryTiles[(index+1)-c].subTile.popularFilterTitle}}{{=popularFilterOption[0]}}">{{=popularFilterOption[0]}}</a>{{~}}</div><div class="btnLinkWrapper mobLinks">{{~it.categoryTiles[(index+1)-c].subTile.popularFilterOptions : popularFilterOption}}<a selenium="checkLink" class="btnLink" href="{{=popularFilterOption[1]}}" title="{{=it.categoryTiles[(index+1)-c].subTile.popularFilterTitle}}{{=popularFilterOption[0]}}">{{=popularFilterOption[0]}}</a>{{~}}</div></div><div class="catTile subTile brandTile"><p class="txtLink">Shop by Brand</p><div class="btnLinkWrapper desktopLinks">{{~it.categoryTiles[(index+1)-c].subTile.popularBrands : popularBrand}}<a selenium="checkLink" class="btnLink" href="{{=popularBrand.url}}" title="{{=popularBrand.name}}"><img src="{{=popularBrand.imageUrl}}" alt="{{=popularBrand.name}}"></a>{{~}}</div><div class="btnLinkWrapper mobLinks">{{~it.categoryTiles[(index+1)-c].subTile.popularBrands : popularBrand}}<a selenium="checkLink" class="btnLink" href="{{=popularBrand.url}}" title="{{=popularBrand.name}}"><img src="{{=popularBrand.imageUrl}}" alt="{{=popularBrand.name}}"></a>{{~}}</div></div></div>{{?}}{{~}}<div class="clear"></div>{{?}}{{~}}<div class="catTile placeHolder" style="width:{{=(3-(it.numberOfCategoryTiles%3))*33.33}}%"></div>{{? it.numberOfCategoryTiles % 3==1}}<div style="display: none;">{{=it.lastRowIndex=[1]}}</div>{{?? it.numberOfCategoryTiles % 3==2}}<div style="display: none;">{{=it.lastRowIndex=[1,2]}}</div>{{?}}{{~ it.lastRowIndex : c}}{{? it.categoryTiles[(it.numberOfCategoryTiles-c)].hasSubtile}}<div class="submenu-expand" id="{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.id}}" style="display:none;width: 100%;"><span class="indicator"></span><div class="catTile subTile shopAllTile"><a selenium="checkLink" href="{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.shopAllUrl}}" title="Shop All{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].title}}"><img src="{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.shopAllImageUrl}}"><p class="txtLink">All&nbsp;{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].title}}</p><div class="btnLinkWrapper"><p class="btnLink">SHOP ALL</p></div></a></div><div class="catTile subTile popularFilterTile"><p class="txtLink">{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.popularFilterTitle}}</p><img src="{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.popularFilterImageUrl}}" class="subImg" alt="{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.popularFilterTitle}}"><div class="btnLinkWrapper desktopLinks">{{~it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.popularFilterOptions : popularFilterOption}}<a selenium="checkLink" class="btnLink" href="{{=popularFilterOption[1]}}" title="{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.popularFilterTitle}}{{=popularFilterOption[0]}}">{{=popularFilterOption[0]}}</a>{{~}}</div><div class="btnLinkWrapper mobLinks">{{~it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.popularFilterOptions : popularFilterOption}}<a selenium="checkLink" class="btnLink" href="{{=popularFilterOption[1]}}" title="{{=it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.popularFilterTitle}}{{=popularFilterOption[0]}}">{{=popularFilterOption[0]}}</a>{{~}}</div></div><div class="catTile subTile brandTile"><p class="txtLink">Shop by Brand</p><div class="btnLinkWrapper desktopLinks">{{~it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.popularBrands : popularBrand}}<a selenium="checkLink" class="btnLink" href="{{=popularBrand.url}}" title="{{=popularBrand.name}}"><img src="{{=popularBrand.imageUrl}}" alt="{{=popularBrand.name}}"></a>{{~}}</div><div class="btnLinkWrapper mobLinks">{{~it.categoryTiles[(it.numberOfCategoryTiles-c)].subTile.popularBrands : popularBrand}}<a selenium="checkLink" class="btnLink" href="{{=popularBrand.url}}" title="{{=popularBrand.name}}"><img src="{{=popularBrand.imageUrl}}" alt="{{=popularBrand.name}}"></a>{{~}}</div></div></div>{{?}}{{~}}</div>';
		//var templateString = '<h3>{{=it.pageTitle}}</h3><div class="catPageTiles">{{~it.categoryTiles : categoryTile}}<div class="catTile subcategory-tile-menu" id="{{=categoryTile.btnId}}"{{? categoryTile.hasSubtile}}selenium="expandTile"{{?}}>{{? !categoryTile.hasSubtile}}<a href="{{=categoryTile.url}}" selenium="checkLink" title="{{=categoryTile.title}}">{{?}}<img src="{{=categoryTile.imageUrl}}" alt="{{=categoryTile.title}}"><p class="txtLink">{{=categoryTile.title}}</p><div class="btnLinkWrapper"><p class="btnLink">SHOP NOW{{? categoryTile.hasSubtile}}<span class="btnLinkIndicator" style="background: url(http://www.appliancesonline.com.au/images/opt/washing-v2/images/up.png) 0px 11px no-repeat;"></span>{{?}}</p></div>{{? !categoryTile.hasSubtile}}</a>{{?}}</div>{{~}}<div class="catTile placeHolder" style="width:{{=(3-(it.numberOfCategoryTiles%3))*33.33}}%"></div>{{~it.categoryTiles : categoryTile}}{{? categoryTile.hasSubtile}}<div class="submenu-expand" id="{{=categoryTile.subTile.id}}" style="display:none;width: 100%;"><span class="indicator"></span><div class="catTile subTile shopAllTile"><a selenium="checkLink" href="{{=categoryTile.subTile.shopAllUrl}}" title="Shop All{{=categoryTile.title}}"><img src="{{=categoryTile.subTile.shopAllImageUrl}}"><p class="txtLink">All{{=categoryTile.title}}</p><div class="btnLinkWrapper"><p class="btnLink">SHOP ALL</p></div></a></div><div class="catTile subTile popularFilterTile"><p class="txtLink">{{=categoryTile.subTile.popularFilterTitle}}</p><img src="{{=categoryTile.subTile.popularFilterImageUrl}}" class="subImg" alt="{{=categoryTile.subTile.popularFilterTitle}}"><div class="btnLinkWrapper desktopLinks">{{~categoryTile.subTile.popularFilterOptions : popularFilterOption}}<a selenium="checkLink" class="btnLink" href="{{=popularFilterOption[1]}}" title="{{=categoryTile.subTile.popularFilterTitle}}{{=popularFilterOption[0]}}">{{=popularFilterOption[0]}}</a>{{~}}</div><div class="btnLinkWrapper mobLinks">{{~categoryTile.subTile.popularFilterOptions : popularFilterOption}}<a selenium="checkLink" class="btnLink" href="{{=popularFilterOption[1]}}" title="{{=categoryTile.subTile.popularFilterTitle}}{{=popularFilterOption[0]}}">{{=popularFilterOption[0]}}</a>{{~}}</div></div><div class="catTile subTile brandTile"><p class="txtLink">Shop by Brand</p><div class="btnLinkWrapper desktopLinks">{{~categoryTile.subTile.popularBrands : popularBrand}}<a selenium="checkLink" class="btnLink" href="{{=popularBrand.url}}" title="{{=popularBrand.name}}"><img src="{{=popularBrand.imageUrl}}" alt="{{=popularBrand.name}}"></a>{{~}}</div><div class="btnLinkWrapper mobLinks">{{~categoryTile.subTile.popularBrands : popularBrand}}<a selenium="checkLink" class="btnLink" href="{{=popularBrand.url}}" title="{{=popularBrand.name}}"><img src="{{=popularBrand.imageUrl}}" alt="{{=popularBrand.name}}"></a>{{~}}</div></div></div><div class="clear"></div>{{?}}{{~}}</div>';
		var templateFunction = doT.template(templateString);
		$scope.resultHtml = templateFunction({'pageTitle':PageService.pageTitle, 'categoryTiles':PageService.categoryTiles, 'numberOfCategoryTiles':PageService.numberOfCategoryTiles, 'reservedClasses':PageService.reservedClasses});
		$scope.trustedResultHtml = $sce.trustAsHtml($scope.resultHtml);
		console.log("HTML updated!");
		console.log(PageService.categoryTiles[0].title);
	});
}]);
